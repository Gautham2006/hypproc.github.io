<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Service Web App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header Section -->
    <header style="padding: 30px;">
        <div class="logo">
            <img src="Images/thelogo.png" alt="Customer Service AI Agent Logo">
        </div>
        <div class="login-signup">
            <button class="btn login" id="google-signin-btn">Login with Google</button>
            <button class="btn logout" id="google-signout-btn" style="display: none;">Logout</button>
        </div>
    </header>

    <!-- Dashboard Section -->
    <section class="dashboard" id="dashboard" style="display:none;">
        <div class="container">
            <div class="tabs">
                <button class="tab-link active" onclick="openTab(event, 'CallLogs')">Call Logs</button>
                <button class="tab-link" onclick="openTab(event, 'Calendar')">Calendar</button>
                <button class="tab-link" onclick="openTab(event, 'Analytics')">Analytics</button>
            </div>
            <div class="tab-content" id="CallLogs">
                <h2>Recent Call Logs</h2>
                <input type="text" class="search-bar" placeholder="Search logs...">
                <div class="call-log-list">
                    <div class="call-log-entry">
                        <div class="caller-name">John Doe</div>
                        <div class="call-details">
                            <span class="call-date">2024-07-24</span>
                            <span class="call-time">10:30 AM</span>
                            <span class="call-duration">5 mins</span>
                            <span class="call-status completed">Completed</span>
                        </div>
                        <div class="actions">
                            <button class="btn view">View Details</button>
                            <button class="btn delete">Delete</button>
                        </div>
                    </div>
                    <!-- More call log entries can go here -->
                </div>
                <div class="pagination">
                    <button class="btn prev">Previous</button>
                    <button class="btn next">Next</button>
                </div>
            </div>

            <div class="tab-content" id="Calendar" style="display:none;">
                <h2>Your Schedule</h2>
                <iframe id="calendar-iframe" src="" style="border: 0" width="100%" height="600px" frameborder="0" scrolling="no"></iframe>
            </div>

            <div class="tab-content" id="Analytics" style="display:none;">
                <h2>Analytics</h2>
                <!-- Add your analytics content here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-columns">
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Features</a></li>
                        <li><a href="#">Pricing</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <p>Email: support@example.com</p>
                    <p>Phone: (123) 456-7890</p>
                    <div class="social-icons">
                        <a href="#"><img src="facebook-icon.png" alt="Facebook"></a>
                        <a href="#"><img src="twitter-icon.png" alt="Twitter"></a>
                        <a href="#"><img src="linkedin-icon.png" alt="LinkedIn"></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Newsletter</h3>
                    <input type="email" placeholder="Your email">
                    <button class="btn subscribe">Subscribe</button>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const clientId = '164118449897-pcja0agskhvncjl5mrmt6hp2qmcmret8.apps.googleusercontent.com'; // Replace with your actual client ID
            const redirectUri = 'https://hypnos.site/webapp'; // Replace with your actual redirect URI
            const scope = 'https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email';

            console.log('Page loaded');

            // Google OAuth Sign-In
            document.getElementById('google-signin-btn').addEventListener('click', () => {
                console.log('Sign in button clicked');
                const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${encodeURIComponent(scope)}`;
                window.location.href = authUrl;
            });

            //get started
            // document.getElementById('getstarted').addEventListener('click', () => {
            //     console.log('get started button clicked');
            //     const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${encodeURIComponent(scope)}`;
            //     window.location.href = authUrl;
            // });

            // Sign out functionality
            document.getElementById('google-signout-btn').addEventListener('click', () => {
                console.log('Sign out button clicked');
                localStorage.removeItem('access_token');
                window.location.href = redirectUri; // Redirect to the correct URI after logout
            });

            // Handle OAuth 2.0 response
            if (window.location.hash.includes('access_token')) {
                console.log('Access token found in URL');
                const accessToken = window.location.hash.split('&')[0].split('=')[1];
                localStorage.setItem('access_token', accessToken);
                document.getElementById('indexhero').style.display = 'none';
                displayDashboard();
            } else if (localStorage.getItem('access_token')) {
                console.log('Access token found in localStorage');
                document.getElementById('indexhero').style.display = 'none';
                displayDashboard();
            } else {
                console.log('No access token found');
            }

            function displayDashboard() {
                console.log('Displaying dashboard');
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('google-signin-btn').style.display = 'none';
                document.getElementById('google-signout-btn').style.display = 'block';

                // Fetch user's primary calendar ID and update the calendar iframe
                const accessToken = localStorage.getItem('access_token');
                fetch('https://www.googleapis.com/calendar/v3/users/me/calendarList', {
                    headers: {
                        Authorization: `Bearer ${accessToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Calendar List:', data);
                    const primaryCalendar = data.items.find(calendar => calendar.primary);
                    if (primaryCalendar) {
                        updateCalendarIframe(primaryCalendar.id);
                    } else {
                        console.error('Primary calendar not found.');
                    }
                })
                .catch(error => {
                    console.error('Error fetching calendar list:', error);
                });
            }

            function updateCalendarIframe(calendarId) {
                console.log('Updating calendar iframe with calendar ID:', calendarId);
                const iframe = document.getElementById('calendar-iframe');
                iframe.src = `https://calendar.google.com/calendar/embed?src=${calendarId}&ctz=America/New_York`;
            }

            // Tab switching functionality
            window.openTab = function(event, tabName) {
                // Get all elements with class="tab-content" and hide them
                var tabContents = document.getElementsByClassName("tab-content");
                for (var i = 0; i < tabContents.length; i++) {
                    tabContents[i].style.display = "none";
                }

                // Get all elements with class="tab-link" and remove the class "active"
                var tabLinks = document.getElementsByClassName("tab-link");
                for (var i = 0; i < tabLinks.length; i++) {
                    tabLinks[i].className = tabLinks[i].className.replace(" active", "");
                }

                // Show the current tab and add an "active" class to the button that opened the tab
                document.getElementById(tabName).style.display = "block";
                event.currentTarget.className += " active";
            }

            // Set default tab to open
            document.querySelector(".tab-link").click();
        });
    </script>
</body>
</html>
