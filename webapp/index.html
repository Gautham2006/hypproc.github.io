<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Service Web App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="logo">
            <img src="Images/thelogo.png" alt="Customer Service AI Agent Logo">
        </div>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Features</a></li>
                <li><a href="#">Pricing</a></li>
                <li><a href="#">About Us</a></li>
                <li><a href="#">Contact Us</a></li>
            </ul>
        </nav>
        <div class="login-signup">
            <button class="btn login" id="google-signin-btn">Login with Google</button>
            <button class="btn logout" id="google-signout-btn" style="display: none;">Logout</button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-overlay">
            <h1>Revolutionize Your Customer Service Experience</h1>
            <p>Efficient call logs and seamless scheduling</p>
            <button class="btn cta">Get Started Now</button>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="dashboard" id="dashboard" style="display:none;">
        <div class="container">
            <!-- Left Column: Call Logs -->
            <div class="left-column">
                <h2>Recent Call Logs</h2>
                <input type="text" class="search-bar" placeholder="Search logs...">
                <div class="call-log-list">
                    <div class="call-log-entry">
                        <div class="caller-name">John Doe</div>
                        <div class="call-details">
                            <span class="call-date">2024-07-24</span>
                            <span class="call-time">10:30 AM</span>
                            <span class="call-duration">5 mins</span>
                            <span class="call-status completed">Completed</span>
                        </div>
                        <div class="actions">
                            <button class="btn view">View Details</button>
                            <button class="btn delete">Delete</button>
                        </div>
                    </div>
                    <!-- Repeat similar blocks for other call logs -->
                </div>
                <div class="pagination">
                    <button class="btn prev">Previous</button>
                    <button class="btn next">Next</button>
                </div>
            </div>

            <!-- Right Column: Google Calendar -->
            <div class="right-column">
                <h2>Your Schedule</h2>
                <button class="btn add-event">Add New Event</button>
                <iframe id="calendar-iframe" src="" style="border: 0" width="100%" height="600px" frameborder="0" scrolling="no"></iframe>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-columns">
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Features</a></li>
                        <li><a href="#">Pricing</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <p>Email: support@example.com</p>
                    <p>Phone: (123) 456-7890</p>
                    <div class="social-icons">
                        <a href="#"><img src="facebook-icon.png" alt="Facebook"></a>
                        <a href="#"><img src="twitter-icon.png" alt="Twitter"></a>
                        <a href="#"><img src="linkedin-icon.png" alt="LinkedIn"></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Newsletter</h3>
                    <input type="email" placeholder="Your email">
                    <button class="btn subscribe">Subscribe</button>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const clientId = '164118449897-pcja0agskhvncjl5mrmt6hp2qmcmret8.apps.googleusercontent.com'; // Replace with your actual client ID
            const redirectUri = 'https://www.hypnos.site/webapp'; // Replace with your actual redirect URI
            const scope = 'https://www.googleapis.com/auth/calendar.readonly https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email';

            console.log('Page loaded');

            // Google OAuth Sign-In
            document.getElementById('google-signin-btn').addEventListener('click', () => {
                console.log('Sign in button clicked');
                const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${encodeURIComponent(scope)}`;
                window.location.href = authUrl;
            });

            // Sign out functionality
            document.getElementById('google-signout-btn').addEventListener('click', () => {
                console.log('Sign out button clicked');
                localStorage.removeItem('access_token');
                window.location.href = redirectUri; // Redirect to the correct URI after logout
            });

            // Handle OAuth 2.0 response
            if (window.location.hash.includes('access_token')) {
                console.log('Access token found in URL');
                const accessToken = window.location.hash.split('&')[0].split('=')[1];
                localStorage.setItem('access_token', accessToken);
                displayDashboard();
            } else if (localStorage.getItem('access_token')) {
                console.log('Access token found in localStorage');
                displayDashboard();
            } else {
                console.log('No access token found');
            }

            function displayDashboard() {
                console.log('Displaying dashboard');
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('google-signin-btn').style.display = 'none';
                document.getElementById('google-signout-btn').style.display = 'block';

                // Fetch user's primary calendar ID and update the calendar iframe
                const accessToken = localStorage.getItem('access_token');
                fetch('https://www.googleapis.com/calendar/v3/users/me/calendarList', {
                    headers: {
                        Authorization: `Bearer ${accessToken}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    const primaryCalendar = data.items.find(calendar => calendar.primary);
                    if (primaryCalendar) {
                        updateCalendarIframe(primaryCalendar.id);
                    }
                })
                .catch(error => {
                    console.error('Error fetching calendar list:', error);
                });
            }

            function updateCalendarIframe(calendarId) {
                const iframe = document.getElementById('calendar-iframe');
                iframe.src = `https://calendar.google.com/calendar/embed?src=${calendarId}&ctz=America/New_York`;
            }
        });
    </script>
</body>
</html>
